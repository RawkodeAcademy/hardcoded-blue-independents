# syntax=docker/dockerfile:1.6

ARG JDK_IMAGE=gradle:8.10.2-jdk21
ARG RUNTIME_IMAGE=eclipse-temurin:21.0.2_13-jre

FROM ${JDK_IMAGE} AS build
WORKDIR /workspace
COPY . .
RUN gradle --no-daemon :service:installDist

FROM ${RUNTIME_IMAGE} AS runtime
ARG SERVICE_NAME=normalized
ENV SERVICE=${SERVICE_NAME}
ENV PORT=8080
ENV JAVA_OPTS=""
WORKDIR /opt/service
COPY --from=build /workspace/service/build/install/service/ ./
EXPOSE 8080
ENTRYPOINT ["/opt/service/bin/service"]
